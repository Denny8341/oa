<!DOCTYPE html>
<html lang="zh-cn">
<head>	
	<meta charset="utf-8">
	<title>OA管理系统</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="Charisma, a fully featured, responsive, HTML5, Bootstrap admin template.">
	<meta name="author" content="Muhammad Usman">

	<!-- The styles -->
	<link href="/static/css/bootstrap.css" rel="stylesheet">
	<link href="/static/css/main.css" rel="stylesheet">
	<link rel="stylesheet" href="/static/css/zTreeStyle/zTreeStyle.css" type="text/css">
	<style type="text/css">
		input[type=text]{width:85%;}
	</style>
	<script src="/static/js/jquery-1.7.2.min.js"></script>
	<script src="/static/js/bootstrap.min.js"></script>
	<script src="/static/js/factory.js"></script>
	<script type="text/javascript" src="/static/js/jquery.ztree.core-3.5.js"></script>
	<script src="/static/js/jquery.json-2.4.min.js"></script>
	<script src="/static/js/system.js" type="text/javascript"></script>
	<script src="/static/js/script.js"></script>
	<SCRIPT type="text/javascript">
		function download(id){
			window.open('/wdgl/download/'+id)
		}
		function doc_delete(id){
			iframe('wdgl/delete/'+id)
		}
	    //回调
	    function getAllDocCallback(json){
	    	var objs = $.evalJSON(json);
	    	var content = "";
		    //表格赋值
		    for(var i = 0;i<objs.length;i++){
		        content += "<tr class='num'>" +
		        				"<td><input type='radio' name='radio' value='"+objs[i].id+"'"+
		        				"/></td>"+
		                        "<td>"+objs[i].id+"</td>"+
		                        "<td>"+objs[i].name+"</td>"+
		                        "<td>"+objs[i].attachment+"</td>"+							
		                        "<td>"
		                        if(objs[i].create_user == {{current_user.id}}){
		                        	content +="<input type='button' class='btn btn-danger btn-mini' onclick=browse('"+objs[i].id+"') value='浏览' />"
		                        	content +="<input type='button' class='btn btn-danger btn-mini' onclick=download('"+objs[i].id+"') value='下载' />"
		                        	content +="<input type='button' class='btn btn-danger btn-mini' onclick=doc_delete('"+objs[i].id+"') value='删除' />"
		                        }
		                        else{
		                        	if(parseInt(parseInt(objs[i].privilege_operation)&1)!=0){
			                         	content +="<input type='button' class='btn btn-danger btn-mini' onclick=browse('"+objs[i].id+"') value='浏览' />"
			                        }
									if(parseInt(parseInt(objs[i].privilege_operation)&2)!=0){
			                         	content +="<input type='button' class='btn btn-danger btn-mini' onclick=download('"+objs[i].id+"') value='下载' />"
			                        }
		                        }
		                        content +="</td>"+
		                    "</tr>";
		    }
		    $("table tbody").html(content);
		    Frame();
	    }
	    
		//树节点单击回调
		var p_id = 0;
		var type = "";
		var posturl = "";
		function zTreeOnClick(event, treeId, treeNode) {
		  	//工厂模式
			type = treeNode.type
			p_id = treeNode.id
			posturl = "wdgl/new_doc/"+type+"/"+p_id;
		    var get = crud.dom.factory("GET");
		    var url = "/wdgl/get_project_docs/"+treeNode.type+"/"+treeNode.id;
		    get.doGet(url,getAllDocCallback);
		    
		};
		
		//跳转到新增
		function new_doc(){
			if(p_id!=0){
				iframe(posturl);
			}
		}
		//跳转到修改
		function edit_doc(){
			var chkObjs = document.getElementsByName("radio"); 
			var chk=""
			for(var i=0;i<chkObjs.length;i++){
				if(chkObjs[i].checked){ 
					chk = chkObjs[i].value; 
					break; 
				}
			}
			if(chk==""){
				alert("请先在列表中勾选要修改的文档");
			}else{
				posturl = "wdgl/edit_doc/"+chk;
				iframe(posturl);
			}
		}
		
		var setting = {
			data: {
				simpleData: {
					enable: true
				}
			},
			async: {
				enable: true,
				url:"/System/tree/doc/1"
			},
			callback: {
				onClick: zTreeOnClick
			}
		};		
		$(document).ready(function(){						
			$.fn.zTree.init($("#tree"), setting);		
					 	
		});
		//-->
	</SCRIPT>	
</head>

<body onload="setTimeOut();">	
	<div class="content">
		<div class="well place">			
			<i class="icon-home"></i><a href="#">文档管理</a>/<a href="#">文档管理</a>
		</div>	
		{%- with messages = get_flashed_messages(with_categories=true) %}
		  	{%- if messages %}
	    	{%- for category, message in messages %}
	    	<div class="alert alert-{{category}}">
	      		{{message}}
	      	</div>
	    	{%- endfor %}
		  	{%- endif %}
		{%- endwith %}
		<div class="row-fluid">	
			<div class="span4">		
				<i class="icon-bookmark"></i><span class="titletip">部门/项目列表</span>			
				<ul id="tree" class="ztree" style="height:450px;overflow:auto;border:1px solid #94c1dc;"></ul>	
			</div>
			<div class="span8" style="margin-top:25px;">
			<!--<div class="box-content">  -->
				<div style="margin-bottom:5px;">
					<a type="button" class="btn btn-info" href="#" onclick="new_doc();">新增</a>
					<a type="button" class="btn btn-info" href="#" onclick="edit_doc();">修改</a>
				</div>
				<div style="border:1px solid #94c1dc;">				
					<table class="table-list" cellspacing="10">
						<thead>
							<tr>
								<th width="10%"></th>
								<th width="10%">编号</th>
								<th width="30%">名称</th>	
								<th width="30%">文件名</th>			
								<th width="20%">操作</th>
							</tr>
						</thead>
						<tbody class="center">
																			
						</tbody>
					</table>
				</div>
			</div>		
		</div>
	</div><!--/content -->
</body>
</html>
